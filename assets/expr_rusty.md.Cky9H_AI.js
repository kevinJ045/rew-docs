import{_ as t}from"./chunks/logo.DqyNawpZ.js";import{_ as a,c as s,o as i,ah as n}from"./chunks/framework.CS-HvYag.js";const o="/rew-docs/assets/rust.mIFgVB1f.png",m=JSON.parse('{"title":"Rusty Rew","description":"","frontmatter":{},"headers":[],"relativePath":"expr/rusty.md","filePath":"expr/rusty.md"}'),r={name:"expr/rusty.md"};function l(h,e,d,p,u,c){return i(),s("div",null,e[0]||(e[0]=[n('<h1 id="rusty-rew" tabindex="-1">Rusty Rew <a class="header-anchor" href="#rusty-rew" aria-label="Permalink to &quot;Rusty Rew&quot;">‚Äã</a></h1><p><code><img style="display:inline-block;margin-bottom:-7.5px;margin-right:5px;" src="'+t+'" alt="Logo" width="22"> <strong>Rew</strong></code> is being remade with <code><img style="display:inline-block;margin-bottom:-3.5px;margin-right:-5px;" src="'+o+`" alt="Logo" width="22"> rust</code>. The transition was only a matter of time, but this would change the whole focus of rew as a runtime.</p><h2 id="why-rust" tabindex="-1">Why Rust? <a class="header-anchor" href="#why-rust" aria-label="Permalink to &quot;Why Rust?&quot;">‚Äã</a></h2><p>By now, it&#39;s fair to assume you&#39;re aware of rust, it&#39;s one of the most powerful programming languages out there. It comes with a feature at almost all corners and is generally a good language.</p><p>The true reason behind the recreation of rew with rust is to give rew a new purpose.</p><h2 id="rew-s-future" tabindex="-1">Rew&#39;s future <a class="header-anchor" href="#rew-s-future" aria-label="Permalink to &quot;Rew&#39;s future&quot;">‚Äã</a></h2><p>So far, rew has been just another npm package with no purpose to serve. Not an independent language on it&#39;s own, nor is it powerful enough to be. It was mostly utilities on top of nodejs with poor architecture and messy code.</p><p>But-- Now, i want rew to be something actually usable. Hence; the new rew: where rust touches the remnants of the past; <code>coffeescript</code>.</p><p>Basically, I am gonna make it so you can connect rust code with coffeescript/rew to create basically anything.</p><h2 id="history-and-the-cause" tabindex="-1">History and the cause <a class="header-anchor" href="#history-and-the-cause" aria-label="Permalink to &quot;History and the cause&quot;">‚Äã</a></h2><p>I like making desktop apps. Not only that they serve a lot of purpose but they also run independently on your machine. A luxury we&#39;re losing as web technology evolves.</p><p>But as i made apps with rust, it became a hard job to maintain them. Simply put you would have to: - Make a windows executable - Make a linux static executable - Release for AUR - Release for <code>nixpkgs</code> - Release for debian in however way you can - Release for .deb, .rpm and .zst - Release on flathub if possible - Release for <code>nixpkgs</code> with something like <code>home-manager</code> if you want your nix users satisfied (i am a nix user this is a must) - Global linux portable release - Global appimage release</p><p>After looking at all that, it became hard for a knucklehead like me not only to get approved by all these repositories that your app is worth being in their list but also maintaining that. To add that you&#39;re probably alone if you&#39;re a solo dev like me.</p><p>To add salt to injury, rust is by no means an easy language. Sometimes my carelessness leads to segfaults which forces me to go over and debug the whole code to see where it happens. I can never hate rust, but it&#39;s a double edged sword.</p><h2 id="main-point" tabindex="-1">Main point <a class="header-anchor" href="#main-point" aria-label="Permalink to &quot;Main point&quot;">‚Äã</a></h2><p>Imagine using the power of rust, with a simple code and a simple package manager that requires too little work to release? Well that&#39;s the main goal with new rew.</p><h2 id="progress-check" tabindex="-1">Progress check <a class="header-anchor" href="#progress-check" aria-label="Permalink to &quot;Progress check&quot;">‚Äã</a></h2><p>As of now, main rew has already been ported over. it compiles basic coffeescript with extra rew syntaxes and executes it. But there&#39;s still a lot more to be done.</p><table tabindex="0"><thead><tr><th>Feature</th><th>Possible</th><th>Progress</th><th>Level</th></tr></thead><tbody><tr><td>Node.js Support</td><td>‚ùå No</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>FFI</td><td>‚úÖ Yes</td><td>‚úÖ Done</td><td>Low</td></tr><tr><td>Module Resolution</td><td>‚úÖ Yes</td><td>üîÑ In Progress</td><td>High</td></tr><tr><td>App Management</td><td>‚úÖ Yes</td><td>üîÑ In Progress</td><td>High</td></tr><tr><td>Bundling</td><td>‚úÖ Yes</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>STDLIB</td><td>‚úÖ Yes</td><td>üîÑ In Progress</td><td>Low</td></tr><tr><td>JSX</td><td>‚úÖ Yes</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>Qrew</td><td>‚úÖ Yes</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>Secrets</td><td>‚úÖ Yes</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>Rune</td><td>‚úÖ Yes</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>Web</td><td>‚úÖ Yes</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>Serve</td><td>‚úÖ Yes</td><td>‚ùå Not Started</td><td>‚Äî</td></tr><tr><td>Conf</td><td>‚úÖ Yes</td><td>üîÑ In Progress</td><td>Low</td></tr></tbody></table><h2 id="architectures" tabindex="-1">Architectures <a class="header-anchor" href="#architectures" aria-label="Permalink to &quot;Architectures&quot;">‚Äã</a></h2><p>There are a few methods i wanna follow when remaking rew with rust.</p><h3 id="file-stack" tabindex="-1">File Stack <a class="header-anchor" href="#file-stack" aria-label="Permalink to &quot;File Stack&quot;">‚Äã</a></h3><p>Let&#39;s say there&#39;s a huge file stack that loads in files into it and keeps them in check, where you manage your files and replace them dynamically if ever needed. That&#39;s the main component of the new runtime.</p><h3 id="mounter" tabindex="-1">Mounter <a class="header-anchor" href="#mounter" aria-label="Permalink to &quot;Mounter&quot;">‚Äã</a></h3><h4 id="not-called-that-in-code" tabindex="-1">(not called that in code) <a class="header-anchor" href="#not-called-that-in-code" aria-label="Permalink to &quot;(not called that in code)&quot;">‚Äã</a></h4><p>For the sake of communication, let&#39;s call &quot;loading&quot; a script as mounting. Let&#39;s say mounting includes: <code>loading</code>, <code>scanning</code>, <code>compiling</code>, <code>attaching</code>.</p><ul><li><strong><code>loading</code>:</strong><ul><li>This stage is where your first initial file is loaded, it is just reading a file from the path to a string.</li></ul></li><li><strong><code>scanning</code>:</strong><ul><li>At this stage, the loaded file is scanned for files it requires. Then the loader get&#39;s into the game and loads the files required and scans them too.</li></ul></li><li><strong><code>compiling</code>:</strong><ul><li>After the scanning, based on priority it compiles each file that was scanned</li></ul></li><li><strong><code>attaching</code>:</strong><ul><li>Finally, the compiled file is attached to the <a href="#file-stack">File Stack</a> and kept in check</li></ul></li></ul><p>It might seem complicated when i call it <code>Mounter</code> but i hope these 4 steps clear all the confusion.</p><p>Now, our file is filled with files. And a structure that would resemble this:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;/main.coffee&quot;: &quot;compiled_code&quot;,</span></span>
<span class="line"><span>  &quot;/utils.coffee&quot;: &quot;compiled_code&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="module-manager" tabindex="-1">Module manager <a class="header-anchor" href="#module-manager" aria-label="Permalink to &quot;Module manager&quot;">‚Äã</a></h3><p>Now that we have a proper file system, we need a proper way to execute them and help them interact with each other.</p><p>This structure assures that the files remain modular and replacable in case of change for future hmr support.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Modules[&quot;/main.coffee&quot;] = function(options) { return whatever_exported_from_main }</span></span>
<span class="line"><span>Modules[&quot;/utils.coffee&quot;] = function(options) { return whatever_exported_from_utils }</span></span></code></pre></div><h3 id="why-this-structure-instead-of-js-modules" tabindex="-1">Why this structure instead of js modules? <a class="header-anchor" href="#why-this-structure-instead-of-js-modules" aria-label="Permalink to &quot;Why this structure instead of js modules?&quot;">‚Äã</a></h3><p>Simple answer: Compilation. Yes; Having everything in one file means it could be slower, but it also would mean your one single file could be compiled, bundled and in the end executed as a singular file. This means you can attach that single file to a rew binary and make your rew app into a binary bound app.</p><p>Another reason: hmr. Having hmr would mean you can change your code and see the changes in real time. This is a must for any app that requires real time changes. For example: GUI apps.</p><h3 id="v8-optimization-cancelling" tabindex="-1">V8 Optimization cancelling <a class="header-anchor" href="#v8-optimization-cancelling" aria-label="Permalink to &quot;V8 Optimization cancelling&quot;">‚Äã</a></h3><h4 id="assuming-you-know-a-little-bit-about-the-core-of-js" tabindex="-1">(assuming you know a little bit about the core of js) <a class="header-anchor" href="#assuming-you-know-a-little-bit-about-the-core-of-js" aria-label="Permalink to &quot;(assuming you know a little bit about the core of js)&quot;">‚Äã</a></h4><p>With <code>&quot;use strict&quot;</code> any js code would be optimized by v8. But with this structure, it would be hard to optimize the code. So, we would have to cancel the optimization. This would mean that the code would be slower, but it would be more flexible.</p><p>The main reasons why <code>&quot;use strict&quot;</code> or <strong>strict mode</strong> is not used in the main code because of:</p><ul><li><strong>Namespaces and function callers:</strong><ul><li><p>This is a significant part of rew. Not forcing the base code over any namespace like how web js forces you to the <code>DOM</code> by default or nodejs forces you to another means you just got a bunch of bloated functions that don&#39;t need exist in your main namespace.</p></li><li><p>That&#39;s why with rew, namespaces are important. But while getting namespaces to work, we lose the ability to optimize the code hence with namespaces we are giving free access to repeated and uncontrolled object access- meaning no v8 optimizations</p></li></ul></li><li><strong>Freedom of true js:</strong><ul><li><p>JS is a sandbox environment, and will always be. No way around it. But <strong>strict mode</strong> sandboxes it even harder.</p></li><li><p>While JS doesn&#39;t need all of those &quot;forbidden&quot; functionalities locked by <strong>strict mode</strong>. Sometimes, you might find yourself scratching your head trying to do something that is possible but not allowed.</p></li></ul></li></ul><p>In the mean time, i will try to actually get v8 optimizations over free namespace access to work while still maintaining namespaces and function callers.</p><h3 id="about-the-runtime-environment" tabindex="-1">About the runtime environment <a class="header-anchor" href="#about-the-runtime-environment" aria-label="Permalink to &quot;About the runtime environment&quot;">‚Äã</a></h3><p>The currently going project uses <a href="https://crates.io/crates/deno_core" target="_blank" rel="noreferrer"><code>deno_core</code></a> which is just the root of the javascript runtime <a href="https://github.com/denoland/" target="_blank" rel="noreferrer"><code>Deno</code></a>.</p><p><code>deno_core</code> is a really easy to use crate that really makes it easy to do anything with js.</p><h3 id="ffi" tabindex="-1">FFI <a class="header-anchor" href="#ffi" aria-label="Permalink to &quot;FFI&quot;">‚Äã</a></h3><p>My favorite part of all of this. FFI(Foreign Function Interface) is basically just including functions from something like <code>C</code> for example in your code from other languages.</p><p>In my case, i used <code>deno_ffi</code> since it had a few things that could help without rewriting the whole extension with something <code>libloading</code> in rust.</p><p>Here is the current structure:</p><div class="language-coffee vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">coffee</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#std.ffi!&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rew</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ffi;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rew</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">myLib</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/path/to/lib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">instantiate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ffi_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -&gt;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pre</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr, ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">to_string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ffi_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i32, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i32) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_number</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -&gt;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pre</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> ffi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i32, parseInt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myLib.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myLib.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><details class="details custom-block"><summary>More</summary><p>This basically just opens a C library and then uses it to &quot;add_number&quot; and &quot;add_string&quot;</p></details><h2 id="support-for-nodejs" tabindex="-1">Support for nodejs <a class="header-anchor" href="#support-for-nodejs" aria-label="Permalink to &quot;Support for nodejs&quot;">‚Äã</a></h2><p>Support for nodejs is one of the things that i can&#39;t wrap my head around. I thought of adding it, but then it would mean i would be making the whole environment yet another nodejs environment with less support for nodejs.</p><p>Besides, the fact that adding nodejs support could potentially break the current system should not be ignored-</p><p>So, for now, i won&#39;t be making support for nodejs. Rew will have it&#39;s own module resolution, and and it&#39;s own library management away from nodejs. but that doesn&#39;t mean it will lack in functionality, but it WILL lose on the nodejs environment side-</p><p>I might however, sooner or later, add a support for nodejs through workarounds and other fuckery maybe even through ffi. But for now, it won&#39;t have nodejs support.</p><h2 id="help-and-support" tabindex="-1">Help and support <a class="header-anchor" href="#help-and-support" aria-label="Permalink to &quot;Help and support&quot;">‚Äã</a></h2><p>If you like the idea, and would like to either see the code or even contribute, Here is the <a href="https://github.com/kevinj045/rew-rust" target="_blank" rel="noreferrer">github</a>. Otherwise, if you have any questions or want feature additions/have better ideas. Feel free to reach out.</p>`,59)]))}const y=a(r,[["render",l]]);export{m as __pageData,y as default};
